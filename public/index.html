<!DOCTYPE html>
<html>
<head>
    <title>لوحة تحكم التطبيق</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 500px; margin: auto; }
        input, button, select { display: block; margin-bottom: 10px; padding: 10px; width: 100%; box-sizing: border-box; }
        #status { font-weight: bold; }
    </style>
</head>
<body>
    <h2>لوحة تحكم تحديث التطبيق</h2>
    
    <form id="uploadForm">
        <label>ملف APK الجديد:</label>
        <input type="file" id="apkFile" name="apkFile" accept=".apk" required />
        
        <label>رقم الإصدار (Code - مثل 2, 3, 4):</label>
        <input type="number" id="versionCode" name="versionCode" placeholder="2" required />
        
        <label>اسم الإصدار (Name - مثل 1.0.1):</label>
        <input type="text" id="versionName" name="versionName" placeholder="1.0.1" required />

        <label>كلمة المرور (Secret):</label>
        <input type="password" id="secret" name="secret" placeholder="كلمة المرور السرية" required />
        
        <button type="submit">نشر التحديث</button>
    </form>
    
    <p id="status">الحالة: في انتظار الرفع...</p>

    <script>
        const form = document.getElementById('uploadForm');
        const statusEl = document.getElementById('status');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            statusEl.innerText = "جاري رفع الملف... قد يستغرق هذا وقتاً...";
            statusEl.style.color = "blue";
            
            // استخدام FormData لإرسال الملفات والبيانات
            const formData = new FormData(form);

            try {
                // نرسل البيانات إلى الـ API الخاص بنا
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData, // لا نحتاج لـ headers, المتصفح يضعها تلقائياً
                });

                const result = await response.json();

                if (response.ok) {
                    statusEl.innerText = `تم النشر بنجاح! الإصدار: ${result.versionName}`;
                    statusEl.style.color = "green";
                    form.reset();
                } else {
                    throw new Error(result.error || 'فشل الرفع');
                }
            } catch (error) {
                console.error(error);
                statusEl.innerText = "حدث خطأ: " + error.message;
                statusEl.style.color = "red";
            }
        });
    </script>
</body>
</html>